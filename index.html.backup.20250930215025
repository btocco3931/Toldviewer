<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TOLD Viewer</title>
<style>
  body { margin:0; background:#111; color:#fff; font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }
  .screen { display:none; align-items:center; justify-content:center; min-height:100vh; padding:20px; }
  #loadScreen { display:flex; flex-direction:column; gap:12px; }
  #resultsScreen { align-items:flex-start; }
  .card { position:relative; background:#1b1b1b; border-radius:16px; padding:20px 20px 88px; width:min(720px,92vw); box-shadow:0 8px 24px rgba(0,0,0,.45); }
  .card h2 { margin:0 0 10px; font-size:1.4rem; }
  .row { display:flex; justify-content:space-between; gap:12px; padding:6px 0; border-bottom:1px dashed #2b2b2b; }
  .row:last-of-type { border-bottom:0; }
  .label { opacity:.75; }
  .editable p { margin:10px 0; }
  input.required { border:2px solid #e33; color:#e33; background:transparent; padding:6px 8px; border-radius:10px; }
  input.filled   { border:2px solid #ddd; color:#fff; background:transparent; padding:6px 8px; border-radius:10px; }
  .sob-box { position:absolute; bottom:16px; right:16px; border:3px solid #fff; border-radius:12px; width:82px; height:56px; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:1.3rem; }
  .sob-box input { border:none; width:100%; text-align:center; font:inherit; color:inherit; background:transparent; }
</style>
</head>
<body>

<!-- Load screen -->
<div id="loadScreen" class="screen">
  <h1>Load TOLD JSON</h1>
  <input type="file" id="fileInput" accept=".json">
  <div style="opacity:.7;font-size:.9rem">Pick your <code>data.json</code></div>
</div>

<!-- Results screen -->
<div id="resultsScreen" class="screen">
  <div id="cardContainer"></div>
</div><div id="resultsScreen" class="screen">
  <div id="cardContainer"></div>
</div><div id="resultsScreen" class="screen">
  <div id="cardContainer"></div>
</div><div id="resultsScreen" class="screen">
  <div id="cardContainer"></div>
</div>

<script>
(function(){
  "use strict";
  function showScreen(id){
    document.getElementById("loadScreen").style.display = (id==="loadScreen"?"flex":"none");
    document.getElementById("resultsScreen").style.display = (id==="resultsScreen"?"flex":"none");
  }
  function safe(v){ return (v==null ? "" : String(v)); }

  document.addEventListener("DOMContentLoaded",function(){
    showScreen("loadScreen");
    var picker=document.getElementById("fileInput");
    picker.addEventListener("change",function(e){
      var file=e.target.files[0]; if(!file) return;
      var reader=new FileReader();
      reader.onload=function(ev){
        var data;
        try{ data=JSON.parse(ev.target.result); }
        catch(err){ alert("Invalid JSON"); console.error(err); return; }
        ["updatedETA","gateInfo","wdrMax","sob"].forEach(k=>localStorage.removeItem(k));
        renderCard(data); showScreen("resultsScreen");
      };
      reader.readAsText(file);
    });
  });

function renderCard(data){
  var etaExtra = data.ETA_Zulu ? " ("+data.ETA_Zulu+" / "+(data.ETA_Local||"")+")" : "";
  var html="";
  html+="<div class=x27cardx27>";
  html+="<h2>"+(data.FlightNumber||"")+" <span style=x27opacity:.6x27>("+(data.ShipNumber||"")+")</span></h2>";
  html+="<div class=x27rowx27><span class=x27labelx27>City Pair</span><span>"+(data.DepartureAirport||"")+" â€“ "+(data.ArrivalAirport||"")+"</span></div>";
  html+="<div class=x27row editablex27><span class=x27labelx27>Gate</span><input type=x27textx27 id=x27gateInfox27 class=x27requiredx27 placeholder=x27Enter Gatex27></div>";
  html+="<div class=x27rowx27><span class=x27labelx27>Route</span><span>"+(data.Route||"")+"</span></div>";
  html+="<div class=x27rowx27><span class=x27labelx27>ETE</span><span>"+(data.ETE||"")+"</span></div>";
  html+="<div class=x27rowx27><span class=x27labelx27>Departure</span><span>"+(data.DepartureTime||"")+"</span></div>";
  html+="<div class=x27rowx27><span class=x27labelx27>ETA</span><span>"+(data.ETA||"")+etaExtra+"</span></div>";
  html+="<div class=x27row editablex27><span class=x27labelx27>Updated ETA</span><input type=x27textx27 inputmode=x27numericx27 id=x27updatedETAx27 class=x27requiredx27 placeholder=x27----x27></div>";
  html+="<div class=x27rowx27><span class=x27labelx27>Block Fuel</span><span>"+(data.BlockFuel||"")+"</span></div>";
  html+="<div class=x27rowx27><span class=x27labelx27>Min TO Fuel</span><span>"+(data.MinTOFuel||"")+"</span></div>";
  html+="<div class=x27rowx27><span class=x27labelx27>Planned Landing Fuel</span><span>"+(data.PlannedLandingFuel||"")+"</span></div>";
  html+="<div class=x27rowx27><span class=x27labelx27>Min Landing Fuel</span><span>"+(data.MinLandingFuel||"")+"</span></div>";
  html+="<div class=x27row editablex27><span class=x27labelx27>WDR Max TO Wt</span><input type=x27textx27 inputmode=x27numericx27 id=x27wdrMaxx27 class=x27requiredx27 placeholder=x27-----x27></div>";
  html+="<div class=x27sob-boxx27><input type=x27textx27 inputmode=x27numericx27 id=x27sobx27 maxlength=x273x27 placeholder=x27---x27 class=x27requiredx27></div>";
  html+="</div>";
  document.getElementById("cardContainer").innerHTML=html;
  document.querySelectorAll(".editable input, .sob-box input").forEach(function(inp){
    var saved=localStorage.getItem(inp.id);
    if(saved){ inp.value=saved; inp.classList.add("filled"); inp.classList.remove("required"); }
    inp.addEventListener("input",function(){
      if(inp.id==="sob"){ inp.value=(inp.value||"").replace(/[^0-9]/g,"").slice(0,3); }
      else if(inp.id==="updatedETA"){ inp.value=(inp.value||"").replace(/[^0-9:]/g,""); }
      else if(inp.id==="wdrMax"){ inp.value=(inp.value||"").replace(/[^0-9]/g,""); }
      localStorage.setItem(inp.id,inp.value);
      if((inp.value||"").trim()!==""){ inp.classList.add("filled"); inp.classList.remove("required"); }
      else { inp.classList.add("required"); inp.classList.remove("filled"); }
    });
  });
}
</script>
</body>
</html>
