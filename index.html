<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TOLD Viewer</title>
<style>
.col-left > div:first-child { font-size: 12px; }
.col-center > div:first-child { font-size: 12px; }.col-left > div:first-child { font-size: 12px; }.date { font-size: 12px; }.date { font-size: 12px; }  body { margin:0; background:#111; color:#fff; font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }
  .screen { display:none; align-items:center; justify-content:center; min-height:100vh; padding:20px; }
  #loadScreen { display:flex; flex-direction:column; gap:12px; }
  #resultsScreen { align-items:flex-start; }
  .card {
    position:relative;
    background:#1b1b1b;
    border-radius:16px;
    padding:20px 20px 88px;
    width:min(900px,95vw);
    box-shadow:0 8px 24px rgba(0,0,0,.45);
    display:grid;
    grid-template-columns: 1fr 1fr 1fr;
    grid-auto-rows: min-content;
    gap:12px;
  }
  .card h2 { margin:0; font-size:1.3rem; text-align:center; grid-column: 2; }
  .col-left  { grid-column:1; }
  .col-center{ grid-column:2; text-align:center; }
  .col-right { grid-column:3; text-align:right; }
  .row-full  { grid-column: 1 / 4; text-align:center; margin-top:12px; border-top:1px dashed #333; padding-top:8px; }
  .label { opacity:.75; margin-right:6px; }
  .editable input.required, .sob-box input.required { border:2px solid #e33; color:#e33; background:transparent; padding:2px 4px; border-radius:6px; }
  .editable input.filled, .sob-box input.filled { border:2px solid #ddd; color:#fff; background:transparent; padding:2px 4px; border-radius:6px; }
  .sob-box {
    position:absolute; bottom:16px; right:16px;
    border:3px solid #fff; border-radius:12px;
    width:82px; height:56px;
    display:flex; align-items:center; justify-content:center;
    font-weight:700; font-size:1.3rem;
  }
  .sob-box input { border:none; width:100%; text-align:center; font:inherit; color:inherit; background:transparent; }
</style>
</head>
<body>

<!-- Load screen -->
<div id="loadScreen" class="screen">
  <h1>Load TOLD JSON</h1>
  <input type="file" id="fileInput" accept=".json">
</div>

<!-- Results screen -->
<div id="resultsScreen" class="screen">
  <div id="cardContainer"></div>
</div>

<script>
(function(){
  function showScreen(id){
    document.getElementById("loadScreen").style.display=(id==="loadScreen"?"flex":"none");
    document.getElementById("resultsScreen").style.display=(id==="resultsScreen"?"flex":"none");
  }

  document.addEventListener("DOMContentLoaded",function(){
    showScreen("loadScreen");
    document.getElementById("fileInput").addEventListener("change",function(e){
      var file=e.target.files[0]; if(!file) return;
      var reader=new FileReader();
      reader.onload=function(ev){
        var data;
        try{ data=JSON.parse(ev.target.result); }
        catch(err){ alert("Invalid JSON"); console.error(err); return; }
        ["updatedETA","gateInfo","wdrMax","sob"].forEach(k=>localStorage.removeItem(k));
        renderCard(data);
        showScreen("resultsScreen");
      };
      reader.readAsText(file);
    });
  });

  function renderCard(d){
    var etaExtra=d.ETA_Zulu?(" ("+d.ETA_Zulu+" / "+(d.ETA_Local||"")+")"):"";
    var html="";

    html+="<div class='card'>";
      // left col
      html+="<div class='col-left'><div><span class='label'>Date:</span>"+(d.Date||"")+"</div>";
      html+="<div style='margin-top:16px'><span class='label'>ETE:</span>"+(d.ETE||"")+"</div>";
html+="<div style='margin-top:10px;'></div>";
html+="<div><span class='label'>SID:</span>"+(d.SID||"")+"</div>";
html+="<div><span class='label'>STAR:</span>"+(d.STAR||"")+"</div>";
html+="<div style='margin-top:10px;'></div>";
      html+="<div style='margin-top:16px'>";
      html+="<div><span class='label'>Block:</span>"+(d.BlockFuel||"")+"</div>";
      html+="<div><span class='label'>Min TO:</span>"+(d.MinTOFuel||"")+"</div>";
      html+="<div><span class='label'>Planned:</span>"+(d.PlannedLandingFuel||"")+"</div>";
      html+="<div><span class='label'>Min Ldg:</span>"+(d.MinLandingFuel||"")+"</div>";
html+="<div><span class='label'>Extra Fuel:</span>"+(d.AvailableDelayFuel||"")+"</div>";
      html+="</div></div>";

      // center col
      html+="<div class='col-center'>";
      html+="<div><span class='label'>Ship #:</span>"+(d.ShipNumber||"")+"</div>";
      html+="<div style='margin-top:8px'>"+(d.DepartureAirport||"")+" â€“ "+(d.ArrivalAirport||"")+"</div>";
      html+="<div style='margin-top:8px'><span class='label'>Flight #:</span>"+(d.FlightNumber||"")+"</div>";
      html+="<div class='editable' style='margin-top:8px'><span class='label'>Gate:</span><input type='text' id='gateInfo' class='required' placeholder='Enter Gate'></div>";
      html+="</div>";

      // right col
      html+="<div class='col-right'>";
      html+="<div><span class='label'>Departure:</span>"+(d.DepartureTime||"")+"</div>";
      html+="<div style='margin-top:16px'><span class='label'>ETA:</span>"+(d.ETA||"")+etaExtra+"</div>";
      html+="<div class='editable' style='margin-top:8px'><span class='label'>Updated ETA:</span><input type='text' inputmode='numeric' id='updatedETA' class='required' placeholder='----'></div>";
      html+="<div class='editable' style='margin-top:40px'><span class='label'>WDR Max TO Wt:</span><input type='text' inputmode='numeric' id='wdrMax' class='required' placeholder='-----'></div>";
      html+="</div>";

      // bottom full width
      html+="<div class='row-full'><span class='label'>Route:</span>"+(d.Route||"")+"</div>";

      // sob box
      html+="<div class='sob-box'><input type='text' inputmode='numeric' id='sob' maxlength='3' placeholder='---' class='required'></div>";

    html+="</div>"; // card

    document.getElementById("cardContainer").innerHTML=html;

    document.querySelectorAll(".editable input, .sob-box input").forEach(function(inp){
      var saved=localStorage.getItem(inp.id);
      if(saved){ inp.value=saved; inp.classList.add("filled"); inp.classList.remove("required"); }
      inp.addEventListener("input",function(){
        if(inp.id==="sob"){ inp.value=(inp.value||"").replace(/[^0-9]/g,"").slice(0,3); }
        else if(inp.id==="updatedETA"){ inp.value=(inp.value||"").replace(/[^0-9:]/g,""); }
        else if(inp.id==="wdrMax"){ inp.value=(inp.value||"").replace(/[^0-9]/g,""); }
        localStorage.setItem(inp.id,inp.value);
        if((inp.value||"").trim()!==""){ inp.classList.add("filled"); inp.classList.remove("required"); }
        else { inp.classList.add("required"); inp.classList.remove("filled"); }
      });
    });
  }
})();
</script>
</body>
</html>
