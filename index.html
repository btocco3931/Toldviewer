<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TOLD Viewer Debug</title>
  <style>
    body { margin:0; font-family:system-ui,sans-serif; background:#111; color:#fff; display:flex; flex-direction:column; align-items:center; padding:1em; }
    #uploader { margin-bottom:1em; display:flex; flex-direction:column; gap:.5rem; }
    button { padding:.5em 1em; border:none; border-radius:6px; background:#06f; color:#fff; font-size:1rem; cursor:pointer; }
    pre { background:#222; color:#0f0; padding:1em; border-radius:6px; max-height:40vh; overflow:auto; width:100%; }
  </style>
</head>
<body>
  <div id="uploader">
    <input type="file" id="fileInput" accept=".json" />
    <button id="loadBtn">Load</button>
    <p id="status">Waitingâ€¦</p>
  </div>
  <div id="cardContainer"></div>
  <pre id="debug"></pre>

  <script>
    let jsonData = null;

    function debug(msg,obj) {
      const out = typeof obj!=="undefined" ? JSON.stringify(obj,null,2) : "";
      document.getElementById("debug").textContent += "\\n" + msg + (out?":\\n"+out:"");
      console.log("[TOLD DEBUG]", msg, obj||"");
    }

    function renderCard(d) {
      debug("Rendering card with data", d);
      document.getElementById("cardContainer").innerHTML = \`
        <div style="background:#222;padding:1em;border-radius:10px;width:90%;max-width:600px;">
          <p>Flight: \${d.FlightNumber||""}</p>
          <p>Ship: \${d.ShipNumber||""}</p>
          <p>Route: \${d.Route||""}</p>
          <p>Fuel: \${d.BlockFuel||""}</p>
          <p>ETA: \${d.ETA||""}</p>
        </div>
      \`;
    }

    document.getElementById("fileInput").addEventListener("change",(e)=>{
      const file = e.target.files[0];
      if (!file) { jsonData=null; return; }
      debug("File selected", {name:file.name,size:file.size});
      const reader = new FileReader();
      reader.onload = (evt)=>{
        try {
          jsonData = JSON.parse(evt.target.result);
          document.getElementById("status").textContent = "File loaded OK";
          debug("Parsed JSON", jsonData);
        } catch(err) {
          document.getElementById("status").textContent = "Invalid JSON!";
          debug("Parse error", {error:err.message, raw:evt.target.result});
          jsonData = null;
        }
      };
      reader.readAsText(file);
    });

    document.getElementById("loadBtn").addEventListener("click",()=>{
      debug("Load button clicked");
      if (!jsonData) {
        document.getElementById("status").textContent = "No JSON data available.";
        debug("No jsonData set");
        return;
      }
      renderCard(jsonData);
    });
  </script>
</body>
</html>
