<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TOLD Viewer</title>
<style>
  body { margin:0; font-family: system-ui, sans-serif; background:#111; color:#fff; }
  header { background:rgba(255,255,255,0.05); padding:10px 15px; text-align:center; font-weight:600; border-bottom:1px solid rgba(255,255,255,0.1);}
  main { padding:20px; }
  .grid { display:grid; grid-template-columns:auto 1fr; gap:6px 12px; margin-bottom:15px; }
  .label { font-size:0.75rem; color:#bbb; text-transform:uppercase; }
  .value { font-family:monospace; }
  .v-speeds { display:flex; gap:12px; margin:15px 0; }
  .v-box { flex:1; text-align:center; padding:10px; background:rgba(255,255,255,0.08); border-radius:12px; }
  .v-box h3 { margin:0; font-size:0.75rem; color:#bbb; }
  .v-box p { margin:5px 0 0; font-size:2.5rem; font-weight:bold; }
  .section { margin-top:15px; }
  .section h4 { margin:0 0 5px; font-size:0.8rem; color:#bbb; }
  .box { padding:10px; background:rgba(255,255,255,0.08); border-radius:10px; font-family:monospace; white-space:pre-wrap; }
  textarea { width:100%; height:100px; margin:15px 0; border:none; border-radius:8px; padding:10px; font-family:monospace; }
  button { background:#28a745; color:#fff; border:none; padding:12px 16px; border-radius:8px; font-size:1rem; margin:5px 0; }
  #dropZone { margin:15px 0; padding:20px; border:2px dashed #666; border-radius:10px; text-align:center; color:#aaa; }
  #dropZone.dragover { background:rgba(255,255,255,0.1); border-color:#0f0; color:#0f0; }
</style>
</head>
<body>

<header id="header">TOLD CARD</header>
<main>
  <textarea id="jsonInput" placeholder="Paste JSON here..."></textarea>
  <button onclick="loadCard()">Load Card</button>
  <button onclick="demoCard()">Demo Card</button>

  <div id="dropZone">ðŸ“‚ Drop JSON file here (or AirDrop to this page)</div>

  <div id="cardDisplay" style="display:none;">
    <div class="grid" id="basics"></div>
    <div class="v-speeds">
      <div class="v-box"><h3>V1</h3><p id="v1">â€”</p></div>
      <div class="v-box"><h3>VR</h3><p id="vr">â€”</p></div>
      <div class="v-box"><h3>V2</h3><p id="v2">â€”</p></div>
    </div>
    <div class="grid" id="weights"></div>
    <div class="section" id="routeSec" style="display:none;">
      <h4>ROUTE</h4>
      <div class="box" id="route"></div>
    </div>
    <div class="section" id="remarksSec" style="display:none;">
      <h4>REMARKS</h4>
      <div class="box" id="remarks"></div>
    </div>
  </div>
</main>

<script>
function renderCard(card) {
  const callsign = card.callsign || card.flightNumber || "TOLD CARD";
  const routeHeader = [card.departure, card.arrival].filter(Boolean).join(" â†’ ");
  document.getElementById("header").textContent = callsign + (routeHeader ? " â€¢ " + routeHeader : "");

  const basics = document.getElementById("basics");
  basics.innerHTML = "";
  const addRow = (label, value) => {
    basics.insertAdjacentHTML("beforeend", `<div class="label">${label}</div><div class="value">${value || "â€”"}</div>`);
  };
  addRow("Runway", card.runway);
  addRow("Flaps", card.flap);
  addRow("Thrust", card.thrust);
  addRow("OAT", card.oat);
  addRow("QNH", card.qnh);

  document.getElementById("v1").textContent = card.v1 || "â€”";
  document.getElementById("vr").textContent = card.vr || "â€”";
  document.getElementById("v2").textContent = card.v2 || "â€”";

  const weights = document.getElementById("weights");
  weights.innerHTML = "";
  addRow("TOW", card.weightTO);
  addRow("ZFW", card.weightZFW);
  addRow("Fuel Rel", card.fuelRelease);
  addRow("FOB", card.fuelOnBoard);

  if (card.route) {
    document.getElementById("route").textContent = card.route;
    document.getElementById("routeSec").style.display = "block";
  } else {
    document.getElementById("routeSec").style.display = "none";
  }

  if (card.remarks) {
    document.getElementById("remarks").textContent = card.remarks;
    document.getElementById("remarksSec").style.display = "block";
  } else {
    document.getElementById("remarksSec").style.display = "none";
  }

  document.getElementById("cardDisplay").style.display = "block";
}

function loadCard() {
  let input = document.getElementById("jsonInput").value;
  try {
    const card = JSON.parse(input);
    renderCard(card);
    localStorage.setItem("lastTOLD", input);
  } catch (e) {
    alert("Invalid JSON: " + e);
  }
}

function demoCard() {
  const demo = {
    "callsign": "DAL136",
    "departure": "KDTW",
    "arrival": "KMSP",
    "runway": "22L",
    "flap": "5",
    "thrust": "FLEX 48C",
    "oat": "12C",
    "qnh": "1017",
    "weightTO": "103.6K",
    "weightZFW": "89.4K",
    "v1": "139",
    "vr": "144",
    "v2": "151",
    "fuelRelease": "17.5",
    "fuelOnBoard": "18.1",
    "route": "PTK..ELX..DBQ..KMSP",
    "remarks": "Anti-ice off. Packs on.",
    "ts": "2025-09-28 21:10Z"
  };
  renderCard(demo);
  localStorage.setItem("lastTOLD", JSON.stringify(demo));
}

// File drop
const dropZone = document.getElementById("dropZone");
dropZone.addEventListener("dragover", e => { e.preventDefault(); dropZone.classList.add("dragover"); });
dropZone.addEventListener("dragleave", () => dropZone.classList.remove("dragover"));
dropZone.addEventListener("drop", e => {
  e.preventDefault(); dropZone.classList.remove("dragover");
  const file = e.dataTransfer.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = ev => {
      try {
        const card = JSON.parse(ev.target.result);
        renderCard(card);
        localStorage.setItem("lastTOLD", ev.target.result);
      } catch { alert("Invalid JSON in file."); }
    };
    reader.readAsText(file);
  }
});

// Auto-load last
window.onload = function() {
  const saved = localStorage.getItem("lastTOLD");
  if (saved) {
    document.getElementById("jsonInput").value = saved;
    try { renderCard(JSON.parse(saved)); } catch {}
  }
};
</script>
</body>
</html>
